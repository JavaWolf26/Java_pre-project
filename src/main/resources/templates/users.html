<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml"
      lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin page</title>
</head>
<body>
<nav th:fragment="navigation" class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
    <div class="container">
        <div style="color:#ffffff" th:object="${principal}">
            <h6><b>Your email: </b>&nbsp;<span th:text="*{getUsername()}"></span>&nbsp;
                <b>and your roles:</b>
                <th:block th:each="role : *{getAuthorities()}">
                    &nbsp;<span th:text="${role.getAuthority().substring(5)}"></span>
                </th:block>
            </h6>
        </div>
        <a type="button" th:href="@{/logout}" class="btn btn-sm btn-outline-light">Logout</a>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
            <div class="container">
                <div class="list-group">
                    <a sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/users}"
                       class="list-group-item list-group-item-action active">Admin</a>
                    <a th:href="@{/user}" class="list-group-item list-group-item-action">User</a>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <div class="container">
                <br>
                <h2>Admin panel</h2>
                <br>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="tabbable" id="tabs-236598">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="tab1-tab" href="#tab1" data-toggle="tab"
                                           role="tab" aria-controls="tab1" aria-selected="true">User table</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab2-tab" href="#tab2" data-toggle="tab" role="tab"
                                           aria-controls="tab2" aria-selected="false">New user</a>
                                    </li>
                                </ul>
                                <div class="tab-content mytab-content" id="myTabContent">
                                    <div class="tab-pane fade show active" id="tab1" role="tabpanel"
                                         aria-labelledby="tab1-tab">
                                        <nav>
                                            <ol class="breadcrumb">
                                                <li class="breadcrumb-item col text-center">
                                                    <h5>All users</h5>
                                                </li>
                                            </ol>
                                        </nav>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-bordered">
                                                <thead>
                                                <tr class="col text-center">
                                                    <th>Id</th>
                                                    <th>Full name</th>
                                                    <th>Age</th>
                                                    <th>E-mail</th>
                                                    <th>Enabled</th>
                                                    <th>Roles</th>
                                                    <th>Actions</th>
                                                </tr>
                                                <tbody>
                                                <tr class="col text-center"
                                                    th:each="user : ${users}">
                                                    <td><a th:text="${user.id}"></a></td>
                                                    <td><a class="col font-weight-bold"
                                                           th:text="${user.fullName}"></a></td>
                                                    <td><a th:text="${user.age}"></a></td>
                                                    <td><a class="col font-weight-bold"
                                                           th:href="@{/user/{email}(email=${user.getUsername()})}"
                                                           th:text="${user.getUsername()}"></a></td>
                                                    <td><a th:text="${user.enabled}"></a></td>
                                                    <td>
                                                        <th:block th:each="role : ${user.roles}">
                                                            &nbsp;<span th:text="${role.name.substring(5)}"></span>&nbsp;
                                                        </th:block>
                                                    </td>
                                                    <td>
                                                        <a type="button" th:href="@{/users/{id}(id=${user.id})}"
                                                           class="bg-primary btn btn-sm btn-secondary">Edit</a>&nbsp;
                                                        &nbsp;<a type="button" th:href="@{/users/{id}(id=${user.id})}"
                                                                 class="bg-danger btn btn-sm btn-secondary">Delete</a>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
                                        <nav>
                                            <ol class="breadcrumb">
                                                <li class="breadcrumb-item col text-center">
                                                    <h5>Add new user</h5>
                                                </li>
                                            </ol>
                                        </nav>
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-md-4"></div>
                                                <div class="col-md-4">
                                                    <form class="col text-center" th:method="POST" th:action="@{/users}"
                                                          th:object="${user}">
                                                        <label for="firstname">First Name</label>
                                                        <p><input class="form-control" type="text"
                                                                  th:field="*{firstname}" id="firstname"/></p>
                                                        <div style="color:red" th:if="${#fields.hasErrors('firstname')}"
                                                             th:errors="*{firstname}"></div>
                                                        <label for="lastname">Last Name</label>
                                                        <p><input class="form-control" type="text"
                                                                  th:field="*{lastname}" id="lastname"/></p>
                                                        <div style="color:red" th:if="${#fields.hasErrors('lastname')}"
                                                             th:errors="*{lastname}"></div>
                                                        <label for="age">Age</label>
                                                        <p><input class="form-control" type="text" th:field="*{age}"
                                                                  id="age"/></p>
                                                        <div style="color:red" th:if="${#fields.hasErrors('age')}"
                                                             th:errors="*{age}"></div>
                                                        <label for="email">Email</label>
                                                        <p><input class="form-control" type="text" th:field="*{email}"
                                                                  id="email"/></p>
                                                        <div style="color:red" th:if="${#fields.hasErrors('email')}"
                                                             th:errors="*{email}"></div>
                                                        <label for="password">Password</label>
                                                        <p><input class="form-control" type="text"
                                                                  th:field="*{password}" id="password"/></p>
                                                        <div style="color:red" th:if="${#fields.hasErrors('password')}"
                                                             th:errors="*{password}"></div>
                                                        <label for="nameRoles">Role</label>
                                                        <p><select name="nameRoles" class="form-control" id="nameRoles"
                                                                   required>
                                                            <option value="">Select access rights...</option>
                                                            <option value="ROLE_USER">USER</option>
                                                            <option value="ROLE_ADMIN">ADMIN</option>
                                                        </select></p>
                                                        <div class="checkbox">
                                                            <label for="enabled">
                                                                <input type="checkbox" id="enabled"
                                                                       th:checked="*{isEnabled()}"
                                                                       th:field="*{enabled}">&nbsp;Is enabled
                                                            </label>
                                                        </div>
                                                        <button class="btn btn-success" type="submit">
                                                            Add new user
                                                        </button>
                                                        <br/>
                                                    </form>
                                                </div>
                                                <div class="col-md-4"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr/>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(() => {
        let url = location.href.replace(/\/$/, "");
        if (location.hash) {
            const hash = url.split("#");
            $('#myTab a[href="#'+hash[1]+'"]').tab("show");
            url = location.href.replace(/\/#/, "#");
            history.replaceState(null, null, url);
            setTimeout(() => {
                $(window).scrollTop(0);
            }, 400);
        }
        $('a[data-toggle="tab"]').on("click", function() {
            let newUrl;
            const hash = $(this).attr("href");
            if(hash === "#tab1") {
                newUrl = url.split("#")[0];
            } else {
                newUrl = url.split("#")[0] + hash;
            }
            newUrl += "/";
            history.replaceState(null, null, newUrl);
        });
    });
</script>
</body>
</html>